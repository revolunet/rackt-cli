#!/bin/bash -e

babel=$RACKT_PATH/node_modules/.bin/babel
webpack=$RACKT_PATH/node_modules/.bin/webpack

# # get user defined config if any or use rackt-cli one
. $RACKT_PATH/tasks/getFilePath
webpackConfig=`getFilePath webpack.build.js`

BUILD="$webpack --devtool source-map --config $webpackConfig"

# Clean old build
rm -rf build/

# Transpile ES6
$babel -d build/lib ./lib

# Generate bundle
mkdir -p dist
eval $BUILD
eval "MINIFY=1 $BUILD"

# Copy package
cp README.md build/
node -p 'p=require("./package");p.scripts=p.devDependencies=undefined;JSON.stringify(p,null,2)' > build/package.json
